struct coordinate {
    int x; 
    int y;
    int index;
};

int heatMatrix[256] = {
    1765, 1751, 1772, 1790, 1782, 1767, 1750, 1737, 1728, 1735, 1780, 1829, 1849, 1854, 1836, 1815, 
    1756, 1750, 1762, 1775, 1779, 1775, 1751, 1725, 1701, 1700, 1757, 1825, 1860, 1875, 1853, 1825, 
    1775, 1760, 1777, 1790, 1772, 1751, 1747, 1750, 1752, 1764, 1793, 1826, 1845, 1857, 1857, 1853, 
    1795, 1775, 1792, 1800, 1760, 1725, 1742, 1775, 1803, 1825, 1826, 1825, 1834, 1850, 1876, 1900, 
    1808, 1789, 1788, 1771, 1697, 1643, 1700, 1778, 1804, 1812, 1800, 1795, 1827, 1875, 1926, 1968, 
    1796, 1800, 1778, 1750, 1717, 1700, 1732, 1775, 1792, 1800, 1793, 1800, 1854, 1925, 1995, 2050, 
    1698, 1796, 1757, 1781, 2061, 2279, 2050, 1770, 1768, 1842, 1885, 1931, 1965, 2006, 2078, 2140, 
    1632, 1800, 1754, 1825, 2350, 2750, 2310, 1775, 1779, 1925, 2007, 2075, 2089, 2100, 2164, 2225, 
    1738, 1832, 1805, 1842, 2132, 2351, 2085, 1793, 1901, 2085, 2123, 2134, 2166, 2203, 2246, 2282, 
    1879, 1875, 1876, 1875, 1862, 1850, 1825, 1850, 2042, 2225, 2203, 2150, 2204, 2275, 2307, 2325, 
    1936, 1906, 1941, 1967, 1922, 1884, 1918, 1992, 2121, 2225, 2179, 2121, 2172, 2251, 2315, 2364, 
    1981, 1950, 2012, 2075, 2078, 2075, 2110, 2150, 2173, 2175, 2118, 2075, 2120, 2200, 2295, 2375, 
    2052, 2034, 2100, 2179, 2236, 2276, 2294, 2281, 2204, 2117, 2049, 2023, 2081, 2170, 2254, 2320, 
    2123, 2125, 2176, 2250, 2350, 2425, 2415, 2350, 2212, 2075, 2010, 2000, 2064, 2150, 2209, 2250, 
    2180, 2198, 2202, 2223, 2292, 2346, 2321, 2262, 2180, 2106, 2073, 2070, 2102, 2146, 2180, 2204, 
    2221, 2250, 2209, 2175, 2200, 2225, 2190, 2150, 2145, 2150, 2150, 2150, 2148, 2150, 2162, 3175, 
};

const unsigned char BASE_SIZE = 8;
const unsigned char SCALE_FACTOR = 2;

void setup() { Serial.begin(115200); }

void loop() {
    coordinate target = locateTarget(heatMatrix, BASE_SIZE*SCALE_FACTOR);
    
    Serial.print("Target: (");
    Serial.print(target.x);
    Serial.print(", ");
    Serial.print(target.y);
    Serial.print(") [");
    Serial.print(target.index);
    Serial.println("]");

    delay(1000);
}
coordinate locateTarget(int matrix[], const int& gridSize) {
    int matrixSize = gridSize * gridSize;

    // Find the maximum value in the interpolated matrix
    int val = matrix[0];
    int pos = 0;

    for (int i = 1; i < matrixSize; i++) {
        if (matrix[i] > val) {
            val = matrix[i];
            pos = i;
        }
    }

    // Convert the 1D position to 2D coordinates
    int x = pos % gridSize;
    int y = pos / gridSize;

    // 
    return {x - gridSize*0.5, -(1 + y - gridSize*0.5), pos};      // Return the coordinates of the maximum value
}
